# 从URL输入到页面展现发生了什么

### URL是什么

- URL：统一资源定位符，用于定位互联网上的资源
- http、https、ftp、file协议

通俗的讲就是地址，url对应的有以上的协议、域名、端口号、文件资源

常见对应的协议有http、https、ftp、file协议等

#### 域名解析及其流程

域名解析就是将域名解析到对应的服务器IP地址

解析流程：

1. 浏览器缓存 - 浏览器会缓存DNS记录一段时间
2. 系统缓存 - 从Hosts文件查找是否有该域名和对应IP
3. 路由器缓存 - 一般路由器也会缓存域名信息
4. ISP DNS缓存 - 比如到电信的DNS上查找缓存
5. 如果都没有找到，则向根域名服务器查找域名对应IP，根域名服务器把请求转发到下一级，直到找到IP
6. 找到IP地址后，通过TCP/IP协议与目标服务器建立3次握手确认，从而建立连接
7. 通过Http/Https协议向服务器主机发送请求

以上几点的应用场景有：

- 修改Hosts文件中域名对应到本地的127.0.0.1，这样在做开发的时候请求的就是本地的资源
- 在出现网络故障的时候，DNS修改为8.8.8.8或者114.114.114.114，这两个服务器分别是google和国内权威机构提供的DNS查询服务器，直接指向以上两个地址可以比较好的解决由于域名解析造成的网络故障问题
- DNS劫持：黑客将ISP DNS劫持到自己设置的DNS中，从而对网站用户造成一定的损失

#### 服务器请求处理及响应

1. 通过域名解析流程与服务器建立联系后，服务器接到URL中的请求，接收这个请求的工具是web server，常用的web server 服务器有 Apache、Nginx、IIS、 Lighttpd
2. web 服务器接收到用户的Request交给网站代码（或者接受请求反向代理到其他服务器），之后开始在服务器上找到具体的目标内容
3. 找到具体的内容这个过程涉及到后端的MVC架构
4. 服务器找到内容后将内容响应发送到浏览器端

#### 浏览器处理

1. HTML字符串被浏览器接受后一句句读取解析，将HTML文件转换为基础的DOM（文档对象模型），构建DOM树完成后，触发DomContentLoaded事件。

2. 解析到link标签后重新发送请求获取CSS，将CSS解析为CSSOM（层叠样式表对象模型），构建为只含样式信息的树，

3. DOM和CSSOM开始合并并构成渲染树，每个节点开始包含具体的样式信息。

4. 计算渲染树中各个节点的信息位置，进行布局

5. 将布局后的渲染树绘制到屏幕上。

6. 解析到script标签后发送请求获取js，并执行代码

   ​







